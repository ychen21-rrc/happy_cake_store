<div class="row g-4">
  <!-- Left: filters + categories -->
  <aside class="col-lg-3">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title">Search</h5>

        <%= form_with url: products_path, method: :get, local: true do |f| %>
          <div class="mb-2">
            <%= f.label :q, "Keyword", class: "form-label" %>
            <%= f.text_field :q, value: params[:q], class: "form-control", placeholder: "cake, cookie..." %>
          </div>

          <div class="mb-2">
            <%= f.label :category_id, "Category", class: "form-label" %>
            <%= f.select :category_id,
                options_for_select([["All Categories",""]] + @categories.map{|c| [c.name, c.id]}, params[:category_id]),
                {}, class: "form-select" %>
          </div>

          <div class="mb-3">
            <%= f.label :filter, "Filter", class: "form-label" %>
            <%= f.select :filter,
                options_for_select([["None",""], ["New","new"], ["On Sale","sale"]], params[:filter]),
                {}, class: "form-select" %>
          </div>

          <%= f.submit "Search", class: "btn btn-primary w-100" %>
        <% end %>
      </div>
    </div>

    <div id="categories" class="list-group shadow-sm">
      <%= link_to "All Products", products_path, class: "list-group-item list-group-item-action #{'active' if params[:category_id].blank?}" %>
      <% @categories.each do |cat| %>
        <%= link_to cat.name,
            products_path(category_id: cat.id),
            class: "list-group-item list-group-item-action #{'active' if params[:category_id].to_s == cat.id.to_s}" %>
      <% end %>
    </div>
  </aside>

  <!-- Right: products -->
  <section class="col-lg-9">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h3 class="mb-0">Products</h3>

      <div class="btn-group">
        <%= link_to "New", products_path(request.query_parameters.merge(filter: "new")), class: "btn btn-outline-secondary btn-sm" %>
        <%= link_to "On Sale", products_path(request.query_parameters.merge(filter: "sale")), class: "btn btn-outline-secondary btn-sm" %>
        <%= link_to "Clear", products_path, class: "btn btn-outline-secondary btn-sm" %>
      </div>
    </div>

    <% if @products.any? %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3">
        <% @products.each do |product| %>
          <div class="col">
            <%= render "products/product_card", product: product %>
          </div>
        <% end %>
      </div>

      <div class="mt-4 d-flex justify-content-center">
        <%= paginate @products %>
      </div>
    <% else %>
      <div class="alert alert-info">No products found.</div>
    <% end %>
  </section>
</div>
